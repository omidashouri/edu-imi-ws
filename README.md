# edu-imi-ws
IMI Education Web Service

------------------------------

CREATE SEQUENCE CRM.SEQ_PERSON_WEB_SERVICE_ID INCREMENT BY 1 MAXVALUE 9999999999999999 MINVALUE 1 CACHE 20;


   CREATE TABLE "CRM"."TBL_PERSON_WEB_SERVICE" 
     (	"ID" NUMBER NOT NULL ENABLE, 
  	"PERSON_ID" NUMBER, 
  	"PERSON_PUBLIC_ID" NVARCHAR2(500), 
  	"ENCRYPTED_PASSWORD" NVARCHAR2(500), 
  	"EMAIL_VERIFICATION_TOKEN" NVARCHAR2(500), 
  	"EMAIL_VERIFICATION_STATUS" NUMBER, 
  	"CREATOR_ID" NUMBER, 
  	"CREATE_DATE_TS" TIMESTAMP (6), 
  	"EDITOR_ID" NUMBER, 
  	"EDIT_DATE_TS" TIMESTAMP (6), 
  	"DESCRIPTION" NVARCHAR2(500), 
  	"CONTACT_ID" NUMBER, 
  	"CONTACT_PUBLIC_ID" NVARCHAR2(500), 
  	""AUTHORITY_ID" NUMBER ",
    "PERSON_EDIT_DATE" NVARCHAR2(10), 
    "CONTACT_EDIT_DATE" NVARCHAR2(10), 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_PK" PRIMARY KEY ("ID")
    USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
    TABLESPACE "USERS"  ENABLE, 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_UK1" UNIQUE ("PERSON_PUBLIC_ID")
    USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
    TABLESPACE "USERS"  ENABLE,
    CONSTRAINT "TBL_PERSON_WEB_SERVICE_UK2" UNIQUE ("PERSON_ID")
      USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
      TABLESPACE "USERS"  ENABLE,
      CONSTRAINT "TBL_PERSON_WEB_SERVICE_UK3" UNIQUE ("CONTACT_ID")
        USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
        TABLESPACE "USERS"  ENABLE, 
      	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_UK4" UNIQUE ("CONTACT_PUBLIC_ID")
        USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
        TABLESPACE "USERS"  ENABLE, 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_FK1" FOREIGN KEY ("PERSON_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_FK2" FOREIGN KEY ("CREATOR_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_FK3" FOREIGN KEY ("EDITOR_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_PERSON_WEB_SERVICE_FK4" FOREIGN KEY ("CONTACT_ID")
  	  REFERENCES "CRM"."TBL_CONTACT" ("ID") ENABLE
     ) SEGMENT CREATION DEFERRED 
    PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
    TABLESPACE "USERS" ;
  
     COMMENT ON COLUMN "CRM"."TBL_PERSON_WEB_SERVICE"."EMAIL_VERIFICATION_STATUS" IS 'NUMBER(1,0)';
  
    CREATE OR REPLACE TRIGGER "CRM"."TBL_PERSON_WEB_SERVICE_TRG" 
  BEFORE INSERT ON CRM.TBL_PERSON_WEB_SERVICE 
  FOR EACH ROW 
  BEGIN
    <<COLUMN_SEQUENCES>>
    BEGIN
      NULL;
    END COLUMN_SEQUENCES;
  END;
  /
  ALTER TRIGGER "CRM"."TBL_PERSON_WEB_SERVICE_TRG" ENABLE;


--- --- ---

   CREATE SEQUENCE  "CRM"."SEQ_CONTACT_WEB_SERVICE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE ;


  CREATE TABLE "CRM"."TBL_CONTACT_WEB_SERVICE" 
     (	"ID" NUMBER NOT NULL ENABLE, 
  	"CONTACT_PUBLIC_ID" NVARCHAR2(500) NOT NULL ENABLE, 
  	"CREATOR_ID" NUMBER, 
  	"CREATE_DATE_TS" TIMESTAMP (6), 
  	"EDITOR_ID" NUMBER, 
  	"EDIT_DATE_TS" TIMESTAMP (6), 
  	"CONTACT_ID" NUMBER, 
  	"CONTACT_EDIT_DATE" NVARCHAR2(10), 
  	 CONSTRAINT "TBL_CONTACT_WEB_SERVICE_PK" PRIMARY KEY ("ID")
    USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
    TABLESPACE "USERS"  ENABLE, 
     CONSTRAINT "TBL_CONTACT_WEB_SERVICE_UK1" UNIQUE ("CONTACT_PUBLIC_ID")
      USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
      TABLESPACE "USERS"  ENABLE, 
    	 CONSTRAINT "TBL_CONTACT_WEB_SERVICE_UK2" UNIQUE ("CONTACT_ID")
      USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
      TABLESPACE "USERS"  ENABLE,   
  	 CONSTRAINT "TBL_CONTACT_WEB_SERVICE_FK1" FOREIGN KEY ("EDITOR_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_CONTACT_WEB_SERVICE_FK2" FOREIGN KEY ("CREATOR_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_CONTACT_WEB_SERVICE_FK3" FOREIGN KEY ("CONTACT_ID")
  	  REFERENCES "CRM"."TBL_CONTACT" ("ID") ENABLE
     ) SEGMENT CREATION DEFERRED 
    PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
    TABLESPACE "USERS" ;
  
    CREATE OR REPLACE TRIGGER "CRM"."TBL_CONTACT_WEB_SERVICE_TRG" 
  BEFORE INSERT ON CRM.TBL_CONTACT_WEB_SERVICE 
  FOR EACH ROW 
  BEGIN
    <<COLUMN_SEQUENCES>>
    BEGIN
      NULL;
    END COLUMN_SEQUENCES;
  END;
  /
  ALTER TRIGGER "CRM"."TBL_CONTACT_WEB_SERVICE_TRG" ENABLE;


// enable validity to user crm

------------------------------

   CREATE SEQUENCE  "EDU"."SEQ_PERIOD_WEB_SERVICE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;


  CREATE TABLE "EDU"."TBL_PERIOD_WEB_SERVICE" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"PERIOD_ID" NUMBER, 
	"PERIOD_PUBLIC_ID" NVARCHAR2(100), 
	"DESCRIPTION" NVARCHAR2(500), 
	"CAN_REGISTER_ONLINE" NVARCHAR2(15), 
	"CREATE_DATE_TS" TIMESTAMP (6), 
	"EDIT_DATE_TS" TIMESTAMP (6), 
	"DELETE_TS" TIMESTAMP (6), 
	 CONSTRAINT "TBL_PERIOD_WEB_SERVICE_PK" PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "TBL_PERIOD_WEB_SERVICE_FK1" FOREIGN KEY ("PERIOD_ID")
	  REFERENCES "EDU"."TBL_PERIOD" ("ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

  CREATE OR REPLACE TRIGGER "EDU"."TBL_PERIOD_WEB_SERVICE_TRG" 
BEFORE INSERT ON EDU.TBL_PERIOD_WEB_SERVICE 
FOR EACH ROW 
BEGIN
  <<COLUMN_SEQUENCES>>
  BEGIN
    IF INSERTING AND :NEW.ID IS NULL THEN
      SELECT SEQ_PERIOD_WEB_SERVICE.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
    END IF;
  END COLUMN_SEQUENCES;
END;
/
ALTER TRIGGER "EDU"."TBL_PERIOD_WEB_SERVICE_TRG" ENABLE;

// enable validity to user crm


------------------------------

   CREATE SEQUENCE  "EDU"."SEQ_STUDENT_API"  MINVALUE 1 MAXVALUE 999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;


   CREATE TABLE "EDU"."TBL_STUDENT_API" 
     (	"ID" NUMBER NOT NULL ENABLE, 
  	"PERSON_ID" NUMBER, 
  	"STUDENT_PUBLIC_ID" NVARCHAR2(500), 
  	"PERSON_PUBLIC_ID" NVARCHAR2(500), 
  	"CREATE_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
  	"EDIT_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
  	"STUDENT_DELETE_STATUS" NUMBER, 
  	"DELETE_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
  	"STUDENT_ID" NUMBER, 
  	"STUDENT_EDIT_DATE" NVARCHAR2(10), 
  	 CONSTRAINT "TBL_STUDENT_API_PK" PRIMARY KEY ("ID")
    USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
    TABLESPACE "USERS"  ENABLE, 
  	 CONSTRAINT "TBL_STUDENT_API_FK1" FOREIGN KEY ("PERSON_ID")
  	  REFERENCES "CRM"."TBL_PERSON" ("ID") ENABLE, 
  	 CONSTRAINT "TBL_STUDENT_API_FK2" FOREIGN KEY ("STUDENT_ID")
  	  REFERENCES "EDU"."TBL_STUDENT" ("ID") ENABLE
     ) SEGMENT CREATION DEFERRED 
    PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
    TABLESPACE "USERS" ;
  
    CREATE OR REPLACE TRIGGER "EDU"."TBL_STUDENT_API_TRG" 
  BEFORE INSERT ON EDU.TBL_STUDENT_API 
  FOR EACH ROW 
  BEGIN
    <<COLUMN_SEQUENCES>>
    BEGIN
      NULL;
    END COLUMN_SEQUENCES;
  END;
  /
  ALTER TRIGGER "EDU"."TBL_STUDENT_API_TRG" ENABLE;


------------------------------

CREATE SEQUENCE  "EDU"."SEQ_REGISTER_API"  MINVALUE 1 MAXVALUE 999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;


CREATE TABLE "EDU"."TBL_REGISTER_API" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"REGISTER_ID" NUMBER, 
	"PERIOD_ID" NUMBER, 
	"STUDENT_ID" NUMBER, 
	"REGISTER_PUBLIC_ID" NVARCHAR2(500), 
	"PERIOD_PUBLIC_ID" NVARCHAR2(500), 
	"STUDENT_PUBLIC_ID" NVARCHAR2(500), 
	"REGISTER_DELETE_STATUS" NUMBER, 
	"REGISTER_ACTIVITY_STATUS" NUMBER, 
	"REGISTER_EDIT_DATE" NVARCHAR2(10), 
	"CREATE_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
	"EDIT_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
	"DELETE_DATE_TS" TIMESTAMP (6) WITH TIME ZONE, 
	 CONSTRAINT "TBL_REGISTER_API_PK" PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "TBL_REGISTER_API_FK1" FOREIGN KEY ("PERIOD_ID")
	  REFERENCES "EDU"."TBL_PERIOD" ("ID") ENABLE, 
	 CONSTRAINT "TBL_REGISTER_API_FK2" FOREIGN KEY ("REGISTER_ID")
	  REFERENCES "EDU"."TBL_REGISTER" ("ID") ENABLE, 
	 CONSTRAINT "TBL_REGISTER_API_FK3" FOREIGN KEY ("STUDENT_ID")
	  REFERENCES "EDU"."TBL_STUDENT" ("ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

  CREATE OR REPLACE TRIGGER "EDU"."TBL_REGISTER_API_TRG" 
BEFORE INSERT ON EDU.TBL_REGISTER_API 
FOR EACH ROW 
BEGIN
  <<COLUMN_SEQUENCES>>
  BEGIN
    IF INSERTING AND :NEW.ID IS NULL THEN
      SELECT SEQ_REGISTER_API.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
    END IF;
  END COLUMN_SEQUENCES;
END;
/
ALTER TRIGGER "EDU"."TBL_REGISTER_API_TRG" ENABLE;




------------------------------